<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Firefox Extras: Refined Findbar</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="A beautiful, customizable findbar for Firefox - centered, fixed, scalable, and fully customizable via SCSS."
    />
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🦊</text></svg>"
    />

    <style>
      :root {
        --primary-color: #ff9500;
        --primary-dark: #cc7700;
        --secondary-color: #0078d4;
        --secondary-dark: #005a9e;
        --background: #ffffff;
        --surface: #f8f9fa;
        --surface-hover: #e9ecef;
        --text-primary: #212529;
        --text-secondary: #6c757d;
        --border: #dee2e6;
        --border-light: #f1f3f4;
        --success: #28a745;
        --warning: #ffc107;
        --danger: #dc3545;
        --shadow: rgba(0, 0, 0, 0.1);
        --shadow-lg: rgba(0, 0, 0, 0.15);
        --border-radius: 8px;
        --border-radius-lg: 12px;
        --transition: all 0.2s ease;
      }

      @media (prefers-color-scheme: dark) {
        :root {
          --background: #1a1a1a;
          --surface: #2d2d2d;
          --surface-hover: #3a3a3a;
          --text-primary: #ffffff;
          --text-secondary: #b0b0b0;
          --border: #404040;
          --border-light: #353535;
          --shadow: rgba(0, 0, 0, 0.3);
          --shadow-lg: rgba(0, 0, 0, 0.4);
        }
      }

      * {
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        line-height: 1.6;
        margin: 0;
        padding: 0;
        background: var(--background);
        color: var(--text-primary);
        font-size: 16px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 2rem;
      }

      /* Header */
      .header {
        background: var(--surface);
        border-bottom: 1px solid var(--border);
        padding: 1rem 0;
        position: sticky;
        top: 0;
        z-index: 100;
        backdrop-filter: blur(10px);
      }

      .header-content {
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 1rem;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        font-size: 1.5rem;
        font-weight: bold;
        text-decoration: none;
        color: var(--text-primary);
      }

      .logo .icon {
        font-size: 2rem;
      }

      .nav {
        display: flex;
        gap: 2rem;
        list-style: none;
        margin: 0;
        padding: 0;
      }

      .nav a {
        color: var(--text-secondary);
        text-decoration: none;
        font-weight: 500;
        transition: var(--transition);
        padding: 0.5rem 0;
        border-bottom: 2px solid transparent;
      }

      .nav a:hover {
        color: var(--primary-color);
        border-bottom-color: var(--primary-color);
      }

      /* Hero Section */
      .hero {
        padding: 4rem 0;
        text-align: center;
        background: linear-gradient(135deg, var(--surface) 0%, var(--background) 100%);
      }

      .hero h1 {
        font-size: 3rem;
        margin: 0 0 1rem 0;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .hero p {
        font-size: 1.25rem;
        color: var(--text-secondary);
        margin: 0 0 2rem 0;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
      }

      .cta-buttons {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
      }

      /* Buttons */
      .btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: var(--border-radius);
        font-size: 1rem;
        font-weight: 600;
        text-decoration: none;
        text-align: center;
        cursor: pointer;
        transition: var(--transition);
        white-space: nowrap;
      }

      .btn-primary {
        background: var(--primary-color);
        color: white;
      }

      .btn-primary:hover {
        background: var(--primary-dark);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px var(--shadow-lg);
      }

      .btn-secondary {
        background: var(--secondary-color);
        color: white;
      }

      .btn-secondary:hover {
        background: var(--secondary-dark);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px var(--shadow-lg);
      }

      .btn-outline {
        background: transparent;
        color: var(--text-primary);
        border: 2px solid var(--border);
      }

      .btn-outline:hover {
        background: var(--surface-hover);
        border-color: var(--primary-color);
        color: var(--primary-color);
      }

      /* Sections */
      .section {
        padding: 4rem 0;
      }

      .section h2 {
        font-size: 2.5rem;
        margin: 0 0 1rem 0;
        text-align: center;
      }

      .section p {
        font-size: 1.125rem;
        color: var(--text-secondary);
        text-align: center;
        max-width: 700px;
        margin: 0 auto 3rem auto;
      }

      /* Features Grid */
      .features {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        margin: 3rem 0;
      }

      .feature {
        background: var(--surface);
        padding: 2rem;
        border-radius: var(--border-radius-lg);
        border: 1px solid var(--border-light);
        text-align: center;
        transition: var(--transition);
      }

      .feature:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 25px var(--shadow-lg);
      }

      .feature-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
      }

      .feature h3 {
        margin: 0 0 1rem 0;
        color: var(--text-primary);
      }

      .feature p {
        margin: 0;
        color: var(--text-secondary);
        text-align: left;
      }

      /* Playground Section */
      .playground {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: var(--border-radius-lg);
        overflow: hidden;
        margin: 2rem 0;
      }

      .playground-header {
        background: var(--primary-color);
        color: white;
        padding: 1.5rem 2rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 1rem;
      }

      .playground-header h3 {
        margin: 0;
        font-size: 1.5rem;
      }

      .playground-content {
        padding: 2rem;
      }

      .playground-description {
        background: var(--warning);
        color: #856404;
        padding: 1rem 1.5rem;
        border-radius: var(--border-radius);
        margin-bottom: 1.5rem;
        border-left: 4px solid #d39e00;
      }

      .playground-description strong {
        display: block;
        margin-bottom: 0.5rem;
      }

      .code-container {
        position: relative;
        margin: 1.5rem 0;
      }

      .code-textarea {
        width: 100%;
        min-height: 400px;
        font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', 'Droid Sans Mono', 'Source Code Pro', monospace;
        font-size: 14px;
        line-height: 1.5;
        padding: 1.5rem;
        border: 2px solid var(--border);
        border-radius: var(--border-radius);
        background: var(--background);
        color: var(--text-primary);
        resize: vertical;
        transition: var(--transition);
      }

      .code-textarea:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(255, 149, 0, 0.1);
      }

      .code-actions {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        margin-top: 1.5rem;
      }

      /* Installation Steps */
      .installation {
        background: var(--surface);
        border-radius: var(--border-radius-lg);
        padding: 2rem;
        margin: 2rem 0;
      }

      .installation h3 {
        margin: 0 0 1.5rem 0;
        color: var(--text-primary);
      }

      .installation-methods {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
      }

      .method {
        background: var(--background);
        border: 1px solid var(--border);
        border-radius: var(--border-radius);
        padding: 1.5rem;
      }

      .method h4 {
        margin: 0 0 1rem 0;
        color: var(--primary-color);
      }

      .method ol {
        margin: 0;
        padding-left: 1.5rem;
      }

      .method li {
        margin-bottom: 0.5rem;
      }

      .code-block {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: var(--border-radius);
        padding: 1rem;
        font-family: monospace;
        font-size: 0.9rem;
        margin: 0.5rem 0;
        overflow-x: auto;
        word-wrap: break-word;
        white-space: pre-wrap;
      }

      /* Responsive text wrapping for long configuration names */
      @media (max-width: 768px) {
        .method li {
          word-wrap: break-word;
          overflow-wrap: break-word;
        }

        .code-block {
          font-size: 0.8rem;
          word-break: break-all;
        }
      }

      /* Footer */
      .footer {
        background: var(--surface);
        border-top: 1px solid var(--border);
        padding: 3rem 0;
        margin-top: 4rem;
        text-align: center;
      }

      .footer-content {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 2rem;
        margin-bottom: 2rem;
      }

      .footer-section h4 {
        margin: 0 0 1rem 0;
        color: var(--text-primary);
      }

      .footer-section ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .footer-section li {
        margin-bottom: 0.5rem;
      }

      .footer-section a {
        color: var(--text-secondary);
        text-decoration: none;
        transition: var(--transition);
      }

      .footer-section a:hover {
        color: var(--primary-color);
      }

      .footer-bottom {
        border-top: 1px solid var(--border);
        padding-top: 1.5rem;
        color: var(--text-secondary);
        font-size: 0.9rem;
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .container {
          padding: 0 1rem;
        }

        .hero h1 {
          font-size: 2rem;
        }

        .hero p {
          font-size: 1rem;
        }

        .section h2 {
          font-size: 2rem;
        }

        .nav {
          gap: 1rem;
        }

        .cta-buttons {
          flex-direction: column;
          align-items: center;
        }

        .code-actions {
          flex-direction: column;
        }

        .btn {
          width: 100%;
          justify-content: center;
        }
      }

      /* Animations */
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .fade-in-up {
        animation: fadeInUp 0.6s ease-out;
      }

      /* Status indicators */
      .status {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.875rem;
        font-weight: 600;
      }

      .status-success {
        background: rgba(40, 167, 69, 0.1);
        color: var(--success);
        border: 1px solid rgba(40, 167, 69, 0.2);
      }

      .status-loading {
        background: rgba(255, 193, 7, 0.1);
        color: var(--warning);
        border: 1px solid rgba(255, 193, 7, 0.2);
      }

      .status-error {
        background: rgba(220, 53, 69, 0.15);
        color: var(--danger);
        border: 1px solid rgba(220, 53, 69, 0.3);
        font-weight: 600;
      }

      @media (prefers-color-scheme: dark) {
        .status-error {
          background: rgba(255, 107, 107, 0.2);
          color: #ff6b6b;
          border: 1px solid rgba(255, 107, 107, 0.4);
        }
      }

      /* Scroll behavior */
      html {
        scroll-behavior: smooth;
      }

      /* Focus styles for accessibility */
      .btn:focus-visible,
      .code-textarea:focus-visible {
        outline: 2px solid var(--primary-color);
        outline-offset: 2px;
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="container">
        <div class="header-content">
          <a href="#" class="logo">
            <span class="icon">🦊</span>
            <span>Firefox Extras</span>
          </a>
          <nav>
            <ul class="nav">
              <li><a href="#features">Features</a></li>
              <li><a href="#playground">Playground</a></li>
              <li><a href="#install">Install</a></li>
              <li>
                <a href="https://github.com/AlexanderReaper7/firefox-extras" target="_blank" rel="noopener">GitHub</a>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
      <div class="container">
        <h1 class="fade-in-up">Refined Findbar</h1>
        <p class="fade-in-up">
          A beautiful, customizable findbar for Firefox. Centered, fixed, scalable, and fully customizable via SCSS.
        </p>
        <div class="cta-buttons fade-in-up">
          <button id="generateLink" class="btn btn-primary">🎨 Customize and Compile in SASS Playground</button>
          <a href="#install" class="btn btn-secondary"> 📦 Install Now </a>
          <a
            href="https://github.com/AlexanderReaper7/firefox-extras"
            target="_blank"
            rel="noopener"
            class="btn btn-outline"
          >
            📚 View Source
          </a>
        </div>
      </div>
    </section>

    <!-- Features Section -->
    <section id="features" class="section">
      <div class="container">
        <div class="features">
          <div class="feature fade-in-up">
            <div class="feature-icon">🎯</div>
            <h3>Centered & Fixed</h3>
            <p>
              The findbar stays centered and fixed in your viewport, making it easy to access without disrupting your
              browsing flow. No more hunting for the search box!
            </p>
          </div>

          <div class="feature fade-in-up">
            <div class="feature-icon">📐</div>
            <h3>Scalable Design</h3>
            <p>
              Adjust the size to match your preferences. From compact to large, the findbar scales beautifully while
              maintaining perfect proportions and readability.
            </p>
          </div>

          <div class="feature fade-in-up">
            <div class="feature-icon">🎨</div>
            <h3>Fully Customizable</h3>
            <p>
              Every aspect is configurable via SCSS. Change colors, positioning, behavior, button grouping, and element
              order to create your perfect search experience.
            </p>
          </div>

          <div class="feature fade-in-up">
            <div class="feature-icon">⚡</div>
            <h3>Performance Focused</h3>
            <p>
              Lightweight CSS implementation with smooth animations. No JavaScript dependencies, minimal resource usage,
              and optimized for daily use.
            </p>
          </div>

          <div class="feature fade-in-up">
            <div class="feature-icon">🔧</div>
            <h3>Easy Installation</h3>
            <p>
              Multiple installation methods including automated scripts for Windows, macOS, and Linux. Get up and
              running in seconds with our deployment tools.
            </p>
          </div>

          <div class="feature fade-in-up">
            <div class="feature-icon">🌍</div>
            <h3>Cross-Platform</h3>
            <p>
              Works seamlessly across all Firefox installations. Consistent experience whether you're on Windows, macOS,
              or Linux.
            </p>
          </div>
        </div>
      </div>
    </section>



    <!-- Installation Section -->
    <section id="install" class="section">
      <div class="container">
        <h2>Installation Guide</h2>
        <p>Choose your preferred installation method.</p>

        <div class="installation">
          <h3>📦 Installation Methods</h3>
          <div class="installation-methods">
            <div class="method">
              <h4>🚀 Quick Install (Recommended)</h4>
              <ol>
                <li>Open PowerShell (Windows) or Terminal (macOS/Linux)</li>
                <li>Run the installation command:</li>
              </ol>
              <div class="code-block">iwr https://raw.githubusercontent.com/AlexanderReaper7/firefox-extras/main/scripts/deploy.ps1 | iex</div>
              <p>
                <small
                  >⚠️ Always review remote scripts before running. Requires PowerShell Core on non-Windows
                  platforms.</small
                >
              </p>
            </div>

            <div class="method">
              <h4>📁 Manual Installation</h4>
              <ol>
                <li>
                  Download <code>firefox-chrome.zip</code> from
                  <a href="https://github.com/AlexanderReaper7/firefox-extras/releases" target="_blank" rel="noopener"
                    >Releases</a
                  >
                </li>
                <li>Open Firefox profile folder (about:profiles → Open Folder)</li>
                <li>Extract the <code>chrome/</code> folder to your profile</li>
                <li>Set <code>toolkit.legacyUserProfileCustomizations.stylesheets = true</code> in about:config</li>
                <li>Restart Firefox</li>
              </ol>
            </div>

            <div class="method">
              <h4>🛠️ Development Install</h4>
              <ol>
                <li>Clone the repository:</li>
              </ol>
              <div class="code-block">git clone https://github.com/AlexanderReaper7/firefox-extras.git</div>
              <ol start="2">
                <li>Install dependencies and build:</li>
              </ol>
              <div class="code-block">npm install && npm run build</div>
              <ol start="3">
                <li>Deploy to Firefox:</li>
              </ol>
              <div class="code-block">npm run deploy:local</div>
            </div>
          </div>
        </div>

        <div class="installation">
          <h3>⚙️ Configuration Options</h3>
          <p>The findbar can be customized using SCSS variables:</p>
          <code>
          <ul>
            <li><strong>$float:</strong> Enable floating/overlay mode</li>
            <li><strong>$float-alignment:</strong> Position (top, bottom)</li>
            <li><strong>$float-distance:</strong> Distance from viewport edge</li>
            <li><strong>$buttons:</strong> Show prev/next navigation buttons</li>
            <li><strong>$buttons-grouped:</strong> Group buttons visually with text box</li>
            <li><strong>$hide-close-button:</strong> Show/hide the close button</li>
            <li><strong>$hide-when-unfocused:</strong> Auto-hide when not in use</li>
            <li><strong>$opacity-when-unfocused:</strong> Transparency when not focused (0-1)</li>
            <li><strong>$fixed:</strong> Use fixed positioning (stays in viewport)</li>
            <li><strong>$centered:</strong> Center horizontally on the page</li>
            <li><strong>$scale:</strong> Scale factor for size (1.0 = default, 1.5 = 150%)</li>
            <li><strong>$side-margin:</strong> Custom side margins (null = auto)</li>
            <li><strong>$order:</strong> Customize the order of findbar elements</li>
          </ul>
        </code>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
      <div class="container">
        <div class="footer-content">
          <div class="footer-section">
            <h4>Project</h4>
            <ul>
              <li>
                <a href="https://github.com/AlexanderReaper7/firefox-extras/blob/main/README.md" target="_blank"
                  rel="noopener">README</a>
              </li>
              <li>
                <a href="https://github.com/AlexanderReaper7/firefox-extras" target="_blank" rel="noopener"
                  >Source Code</a
                >
              </li>
              <li>
                <a href="https://github.com/AlexanderReaper7/firefox-extras/releases" target="_blank" rel="noopener"
                  >Releases</a
                >
              </li>
              <li>
                <a href="https://github.com/AlexanderReaper7/firefox-extras/issues" target="_blank" rel="noopener"
                  >Report Issues</a
                >
              </li>
              <li>
                <a
                  href="https://github.com/AlexanderReaper7/firefox-extras/blob/main/DEVELOPMENT.md"
                  target="_blank"
                  rel="noopener"
                  >Development</a
                >
              </li>
            </ul>
          </div>

          <div class="footer-section">
            <h4>Attribution</h4>
            <ul>
              <li>
                <a href="https://github.com/ravindUwU/firefox-refined-findbar" target="_blank" rel="noopener"
                  >Original Project</a
                >
              </li>
              <li><a href="https://github.com/AlexanderReaper7" target="_blank" rel="noopener">AlexanderReaper7</a></li>
              <li>
                <a
                  href="https://github.com/AlexanderReaper7/firefox-extras/blob/main/LICENSE"
                  target="_blank"
                  rel="noopener"
                  >MIT License</a
                >
              </li>
            </ul>
          </div>
        </div>

        <div class="footer-bottom">
          <p>
            Licensed under MIT. Based on and inspired by
            <a href="https://github.com/ravindUwU/firefox-refined-findbar" target="_blank" rel="noopener"
              >ravindUwU/firefox-refined-findbar</a
            >.
          </p>
        </div>
      </div>
    </footer>

    <!-- JavaScript -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const button = document.getElementById('generateLink');

        // Compression + encoding helpers
        async function deflateToBase64(input) {
          const encoder = new TextEncoder();
          const data = encoder.encode(input);
          if ('CompressionStream' in window) {
            const cs = new CompressionStream('deflate');
            const writer = cs.writable.getWriter();
            const reader = cs.readable.getReader();
            writer.write(data);
            writer.close();
            const chunks = [];
            while (true) {
              const { value, done } = await reader.read();
              if (done) break;
              if (value) chunks.push(value);
            }
            const total = chunks.reduce((n, c) => n + c.length, 0);
            const compressed = new Uint8Array(total);
            let offset = 0;
            for (const c of chunks) {
              compressed.set(c, offset);
              offset += c.length;
            }
            return btoa(String.fromCharCode(...compressed));
          }
          console.warn('CompressionStream not available, using base64 without compression');
          return btoa(input);
        }

        async function serializeStateContents(inputValue) {
          // Prefix: 1 (SCSS input) + 1 (expanded CSS)
          const persistedState = `11${inputValue}`;
          return deflateToBase64(persistedState);
        }

        // Try to fetch SCSS from source; fallback to embedded copy
        async function getScssContent() {
          try {
            const res = await fetch('../src/findbar.scss', { cache: 'no-store' });
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
            return await res.text();
          } catch (e) {
            console.warn('Falling back to embedded SCSS:', e);
            return `/* Refined findbar for Firefox
   Extended with fixed/centered placement, scaling, and side margins.
   Attribution: Based on and inspired by https://github.com/ravindUwU/firefox-refined-findbar

   The customization options are at the bottom of this document.

 * Usage:
 * - Edit the options below to customize the findbar appearance
 * - Run \`npm run build\` to compile to CSS
 * - Copy the generated chrome/ folder to your Firefox profile
 *
 * @see chrome/userChrome.css for the Firefox integration
*/

@use 'sass:list';
@use 'sass:math';
@use 'sass:map';

@mixin /* sig:start */
  refined-findbar(
    $float: true,
    $float-alignment: bottom,
    $float-distance: 18px,

    $buttons: true,
    $buttons-grouped: true,

    $hide-close-button: false,
    $hide-when-unfocused: false,
    $opacity-when-unfocused: 1,

    $order: (
      TEXT_BOX,
      CHECKBOX_HIGHLIGHT_ALL,
      CHECKBOX_MATCH_CASE,
      CHECKBOX_MATCH_DIACRITICS,
      CHECKBOX_WHOLE_WORDS,
      LABELS,
      DESCRIPTION,
    ),

    /* NEW: positioning and layout */ $fixed: false,
    $centered: false,

    /* NEW: scaling */ $scale: 1,

    /* NEW: symmetric left/right margin (defaults to $float-distance) */ $side-margin: null
  )
  /* sig:end */ {
  @namespace url('http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul');
  @namespace htmlNs url('http://www.w3.org/1999/xhtml');

  /* Derived sizing based on scale */
  $space: $-space * $scale;
  $pad-all: 6px * $scale;
  $border-w: 1px * $scale;
  $check-pad-y: 3px * $scale;
  $check-pad-x: 6px * $scale;

  /* Resolve side margin default */
  $lr-margin: if($side-margin == null, $float-distance, $side-margin);

  // MARK: Position

  findbar {
    contain: content;

    /* Scale text and inherited sizes */
    @if ($scale != 1) {
      font-size: #{math.percentage($scale)};
    }

    /* The findbar sits in a relatively positioned vbox.browserContainer.
       We absolutely position within it by default; optionally switch to fixed. */
    position: if($fixed, fixed, absolute);

    @if $float {
      /* Vertical offset */
      #{$float-alignment}: $float-distance;

      @if $centered {
        /* center horizontally with equal margins from both sides */
        left: $lr-margin;
        right: $lr-margin;
        margin-inline: auto;
        width: max-content;
        @if $fixed {
          max-width: calc(100vw - #{2 * $lr-margin});
        } @else {
          max-width: calc(100% - #{2 * $lr-margin});
        }
        z-index: 9999;
      } @else {
        right: $float-distance;
      }
    } @else {
      /* Docked mode: merge into top chrome by -1px */
      top: -1px;
      right: 44px;
    }
  }

  // MARK: Children

  findbar {
    gap: $space;
    padding: $pad-all;
    padding-inline-start: $space;
    padding-inline-end: $space;

    & > * {
      margin-inline-start: 0 !important;
      margin-inline-end: 0 !important;
    }

    .findbar-container {
      gap: $space;

      & > * {
        margin-inline-start: 0 !important;
        margin-inline-end: 0 !important;
      }
    }

    description.findbar-label:empty {
      display: none;
    }

    @if ($hide-close-button) {
      toolbarbutton.findbar-closebutton {
        display: none;
      }
    }
  }

  // MARK: Border

  findbar {
    border: #{$border-w} solid var(--chrome-content-separator-color);

    @if $float {
      border-radius: var(--toolbarbutton-border-radius);
    } @else {
      border-bottom-left-radius: var(--toolbarbutton-border-radius);
      border-bottom-right-radius: var(--toolbarbutton-border-radius);
      border-top-width: 0 !important;
    }
  }

  // MARK: Animation

  @keyframes refined-findbar-scale-in {
    0% {
      transform: scaleY(0);
    }
    100% {
      transform: scaleY(1);
    }
  }

  @keyframes refined-findbar-scale-out {
    0% {
      transform: scaleY(1);
      visibility: visible;
    }
    99% {
      transform: scaleY(0);
      visibility: visible;
    }
    100% {
      transform: scaleY(0);
    }
  }

  findbar {
    transform-origin: if($float, $float-alignment, top) center;
    animation: refined-findbar-scale-in 0.1s;

    &[hidden='true'] {
      animation: refined-findbar-scale-out 0.1s;
    }
  }

  // MARK: Hide when unfocused

  @if ($hide-when-unfocused) {
    @keyframes refined-findbar-hide-when-unfocused {
      0% {
        opacity: 1;
        height: auto;
      }
      99% {
        opacity: 1;
        height: auto;
      }
      100% {
      }
    }

    findbar:not(:focus-within) {
      animation:
        refined-findbar-scale-out 0.1s,
        refined-findbar-hide-when-unfocused 0.1s;
      height: 0;
      opacity: 0;
      pointer-events: none;
      overflow: hidden;
    }
  }

  // MARK: Opacity when unfocused

  @if ($opacity-when-unfocused < 1) {
    findbar {
      transition: opacity 0.1s;
      opacity: 1;

      &:not(:focus-within) {
        opacity: $opacity-when-unfocused;
      }
    }
  }

  // MARK: Text box

  findbar [anonid='findbar-textbox-wrapper'] {
    htmlNs|input {
      border: #{$border-w} solid ThreeDShadow;

      @if $buttons and $buttons-grouped {
        &:not(.minimal) {
          border-top-right-radius: 0 !important;
          border-bottom-right-radius: 0 !important;
        }
      }
    }

    /* Prev & next buttons (hidden in quick find mode) */
    toolbarbutton {
      color: var(--button-color);
      background-color: #{-var(button-background-color, button-bgcolor)};
      border: #{$border-w} solid ThreeDShadow;
      margin-inline: 0 !important;

      @if $buttons and $buttons-grouped {
        &:last-of-type {
          border-top-left-radius: 0 !important;
          border-bottom-left-radius: 0 !important;
        }
        &:not(:last-of-type) {
          border-radius: 0 !important;
          border-right-width: 0 !important;
        }
      }
    }
  }

  // MARK: Checkboxes

  $checkbox-by-index: ();
  @each $name in map.keys($-checkbox-selectors) {
    $checkbox-by-index: map.set($checkbox-by-index, list.index($order, $name), $name);
  }
  $first-checkbox: map.get($checkbox-by-index, math.min(map.keys($checkbox-by-index)...));
  $last-checkbox: map.get($checkbox-by-index, math.max(map.keys($checkbox-by-index)...));

  findbar checkbox {
    @if $buttons {
      padding: $check-pad-y $check-pad-x;
      border: #{$border-w} solid ThreeDShadow;
      border-radius: var(--toolbarbutton-border-radius);
      color: var(--button-color);
      background-color: #{-var(button-background-color, button-bgcolor)};

      &:hover {
        background-color: #{-var(button-background-color-hover, button-hover-bgcolor)};
      }
      &:active {
        background-color: #{-var(button-background-color-active, button-active-bgcolor)};
      }

      &[checked='true'] {
        color: #{-var(button-text-color-primary, button-primary-color)};
        background-color: #{-var(color-accent-primary, button-primary-bgcolor)};

        &:hover {
          background-color: #{-var(color-accent-primary-hover, button-primary-hover-bgcolor)};
        }
        &:active {
          background-color: #{-var(color-accent-primary-active, button-primary-active-bgcolor)};
        }
      }

      &:focus-visible {
        outline: var(--focus-outline);
        outline-offset: var(--focus-outline-inset);
      }

      .checkbox-check {
        display: none;
      }

      @if $buttons-grouped {
        &:not(#{map.get($-checkbox-selectors, $last-checkbox)}) {
          border-top-right-radius: 0;
          border-bottom-right-radius: 0;
        }
        &:not(#{map.get($-checkbox-selectors, $first-checkbox)}) {
          border-top-left-radius: 0;
          border-bottom-left-radius: 0;
          border-left-width: 0;
          margin-inline-start: -$space !important;
        }
      } @else {
        &:not(#{map.get($-checkbox-selectors, $first-checkbox)}) {
          margin-inline-start: -1 * math.div($space, 2) !important;
        }
      }
    } @else {
      &:is(#{map.get($-checkbox-selectors, $first-checkbox)}) {
        margin-inline-start: math.div($space, 2) !important;
      }
      &:is(#{map.get($-checkbox-selectors, $last-checkbox)}) {
        margin-inline-end: math.div($space, 2) !important;
      }
    }
  }

  // MARK: Order

  findbar {
    [anonid='findbar-textbox-wrapper'] {
      order: list.index($order, TEXT_BOX) - 1;
    }

    @each $name, $selector in $-checkbox-selectors {
      #{$selector} {
        order: list.index($order, $name) - 1;
      }
    }

    label.findbar-label {
      order: list.index($order, LABELS) - 1;
    }

    description.findbar-label {
      order: list.index($order, DESCRIPTION) - 1;
    }
  }
}

$-space: 8px;

/* Checkbox selectors mapping */
$-checkbox-selectors: (
  CHECKBOX_HIGHLIGHT_ALL: "checkbox[anonid='highlight']",
  CHECKBOX_MATCH_CASE: "checkbox[anonid='find-case-sensitive']",
  CHECKBOX_MATCH_DIACRITICS: "checkbox[anonid='find-match-diacritics']",
  CHECKBOX_WHOLE_WORDS: "checkbox[anonid='find-entire-word']",
);

/* var() helper with fallbacks */
@function -var($names...) {
  $css: '';
  @for $i from list.length($names) through 1 {
    @if $css == '' {
      $css: 'var(--' + list.nth($names, $i) + ')';
    } @else {
      $css: 'var(--' + list.nth($names, $i) + ', ' + $css + ')';
    }
  }
  @return $css;
}

/**
 * Configure the findbar with custom options here.
 */
// prettier-ignore
@include refined-findbar(
  // === Positioning Options ===
  $float: true,                     // Enable floating/overlay mode
  $float-alignment: top,            // Position at top of viewport
  $float-distance: 18px,            // Distance from viewport edge

  // === Button Configuration ===
  $buttons: true,                   // Show prev/next navigation buttons
  $buttons-grouped: true,           // Group buttons visually with text box

  // === Visibility Options ===
  $hide-close-button: false,        // Show/hide the close button
  $hide-when-unfocused: false,      // Auto-hide when not in use
  $opacity-when-unfocused: 1,       // Transparency when not focused (0-1)

  // === Element Order ===
  // Customize the order of findbar elements
  $order: (
    TEXT_BOX,                       // Search input field
    CHECKBOX_HIGHLIGHT_ALL,         // Highlight all matches option
    CHECKBOX_MATCH_CASE,            // Case-sensitive search option
    CHECKBOX_MATCH_DIACRITICS,      // Match diacritics option
    CHECKBOX_WHOLE_WORDS,           // Whole words only option
    LABELS,                         // Status labels (e.g., "1 of 5")
    DESCRIPTION,                    // Additional descriptions
  ),

  // === Extended Layout Options ===
  $fixed: true,                     // Use fixed positioning (stays in viewport)
  $centered: true,                  // Center horizontally on the page
  $scale: 1.5,                      // Scale factor for size (1.0 = default)
  $side-margin: null                // Custom side margins (null = auto)
);`;
          }
        }

        if (button) {
          button.addEventListener('click', async () => {
            const originalText = button.textContent;
            try {
              button.textContent = '🔄 Generating...';
              const scss = await getScssContent();
              const encoded = await serializeStateContents(scss);
              const playgroundUrl = `https://sass-lang.com/playground/#${encoded}`;

              // Open in new tab and try to copy URL for convenience
              window.open(playgroundUrl, '_blank', 'noopener,noreferrer');
              try {
                if (navigator.clipboard && window.isSecureContext) {
                  await navigator.clipboard.writeText(playgroundUrl);
                }
              } catch {}

              button.textContent = '✅ Opening Playground!';
            } catch (err) {
              console.error('Failed to generate playground link:', err);
              button.textContent = '🌐 Opening Playground...';
              window.open('https://sass-lang.com/playground/', '_blank', 'noopener,noreferrer');
            } finally {
              setTimeout(() => (button.textContent = originalText), 3000);
            }
          });
        }

        // Smooth scrolling for internal links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
          anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
              target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
          });
        });

        // Add animation classes on scroll
        const observerOptions = { threshold: 0.1, rootMargin: '0px 0px -50px 0px' };
        const observer = new IntersectionObserver(entries => {
          entries.forEach(entry => {
            if (entry.isIntersecting) entry.target.classList.add('fade-in-up');
          });
        }, observerOptions);
        document.querySelectorAll('.feature').forEach(el => observer.observe(el));
      });
    </script>
  </body>
</html>
